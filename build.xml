<project name="plexi" default="build" basedir=".">
  <description>GSA Adaptor library</description>
  <property name="src.dir" location="src"/>
  <property name="test.dir" location="test"/>
  <property name="build.dir" location="classes"/>
  <property name="build-test.dir" location="classes"/>
  <property name="javadoc.dir" location="javadoc"/>
  <property name="lib.dir" location="lib"/>
  <property name="junit.jar" location="${lib.dir}/junit-4.8.2.jar"/>
  <property name="opencsv.jar" location="${lib.dir}/opencsv-2.3.jar"/>
  <property name="adaptor.class" value="adaptortemplate.AdaptorTemplate"/>
  <property name="adaptor.args" value=""/>
  <property name="guava.jar" location="${lib.dir}/guava-r06.jar"/>
  <property name="j-calais.jar" location="${lib.dir}/j-calais-0.2.1.jar"/>
  <property name="jackson-core-asl.jar" location="${lib.dir}/jackson-core-asl-1.5.5.jar"/>
  <property name="jackson-jaxrs.jar" location="${lib.dir}/jackson-jaxrs-1.5.5.jar"/>
  <property name="jackson-mapper-asl.jar" location="${lib.dir}/jackson-mapper-asl-1.5.5.jar"/>
  <property name="jersey-client.jar" location="${lib.dir}/jersey-client-1.3.jar"/>
  <property name="jersey-core.jar" location="${lib.dir}/jersey-core-1.3.jar"/>
  <property name="jsr311-api.jar" location="${lib.dir}/jsr311-api-1.1.1.jar"/>

  <target name="build" description="Build source">
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build-test.dir}"/>
    <javac srcdir="${src.dir}" destdir="${build.dir}" debug="true" includeantruntime="false">
      <classpath location="${opencsv.jar}"/>
      <classpath location="${j-calais.jar}"/>
    </javac>
    <javac srcdir="${test.dir}" destdir="${build-test.dir}" debug="true" includeantruntime="false">
      <classpath location="${junit.jar}"/>
    </javac>
    <copy file="${src.dir}/logging.properties" todir="${build.dir}"/>
    <copy todir="${build.dir}/adaptorlib">
      <fileset dir="${src.dir}/adaptorlib/static"/>
    </copy>
  </target>

  <target name="javadoc" description="Build JavaDocs">
    <javadoc sourcepath="${src.dir}" destdir="${javadoc.dir}"
        overview="${src.dir}/overview.html">
      <classpath location="${opencsv.jar}"/>
      <classpath location="${j-calais.jar}"/>
      <link href="http://download.oracle.com/javase/6/docs/jre/api/net/httpserver/spec/"/>
      <link href="http://download.oracle.com/javase/6/docs/api/"/>
      <arg value="-quiet"/>
    </javadoc>
  </target>

  <target name="clean" description="Remove build output">
    <delete dir="${build.dir}"/>
    <delete dir="${javadoc.dir}"/>
  </target>

  <target name="run" depends="build" description="Run default adaptor">
    <java classpath="${build.dir}" fork="true" classname="${adaptor.class}">
      <sysproperty key="java.util.logging.config.file"
        value="${build.dir}/logging.properties"/>
      <arg line="${adaptor.args}"/>
    </java>
  </target>

  <target name="run-db" depends="build" description="Run database adaptor">
    <java classpath="${build.dir}:${src.dir}/dbadaptortemplate/mysql.jar"
      fork="true" classname="dbadaptortemplate.DbAdaptorTemplate">
      <sysproperty key="java.util.logging.config.file"
        value="${build.dir}/logging.properties"/>
      <arg line="${adaptor.args}"/>
    </java>
  </target>

  <target name="run-fs" depends="build" description="Run filesystem adaptor">
    <java classpath="${build.dir}" fork="true"
      classname="filesystemadaptor.FileSystemAdaptor">
      <sysproperty key="java.util.logging.config.file"
        value="${build.dir}/logging.properties"/>
      <arg line="${adaptor.args}"/>
    </java>
  </target>

  <target name="test" depends="build" description="Run JUnit tests">
    <junit printsummary="yes" haltonfailure="yes">
      <classpath location="${junit.jar}"/>
      <classpath location="${opencsv.jar}"/>
      <classpath location="${j-calais.jar}"/>
      <classpath location="${guava.jar}"/>
      <classpath location="${jackson-core-asl.jar}"/>
      <classpath location="${jackson-jaxrs.jar}"/>
      <classpath location="${jackson-mapper-asl.jar}"/>
      <classpath location="${jersey-client.jar}"/>
      <classpath location="${jersey-core.jar}"/>
      <classpath location="${jsr311-api.jar}"/>
      <classpath location="${build.dir}"/>
      <classpath location="${build-test.dir}"/>
      <formatter type="plain" usefile="false"/>
      <batchtest fork="yes">
        <fileset dir="${test.dir}">
          <include name="**/*Test.java"/>
        </fileset>
      </batchtest>
    </junit>
  </target>
</project>
